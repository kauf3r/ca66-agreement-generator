<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="CA-66 Monterey Bay Academy Airport Usage License Agreement Generator - Streamlined pilot onboarding with safety and compliance validation.">
    <meta name="keywords" content="CA-66, airport, license, agreement, pilot, aviation, Monterey Bay Academy">
    <meta name="author" content="AirSpace Integration, Inc.">
    
    <title>CA-66 Airport Usage License Agreement</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="assets/images/logos/AirSpace Integration Logo.png">
    <link rel="icon" type="image/x-icon" href="assets/images/favicon.ico">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="assets/css/reset.css">
    <link rel="stylesheet" href="assets/css/variables.css">
    <link rel="stylesheet" href="assets/css/layout.css">
    <link rel="stylesheet" href="assets/css/forms.css">
    <link rel="stylesheet" href="assets/css/modal.css?v=2">
    
    <!-- TEMPORARY: Inline modal improvements to bypass cache -->
    <style>
        .modal-container {
            max-width: 950px !important;
        }
        
        .exhibit-content {
            line-height: 1.8 !important;
            font-size: 1rem !important;
        }
        
        .exhibit-content p {
            margin-bottom: 1.2rem !important;
        }
        
        .exhibit-content .rule-section {
            margin-top: 2rem !important;
            margin-bottom: 2rem !important;
            padding: 1.5rem !important;
            background: var(--bg-secondary) !important;
            border-radius: 8px !important;
            border-left: 4px solid var(--primary-blue) !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05) !important;
        }
        
        .exhibit-content h4 {
            font-size: 1.2rem !important;
            font-weight: 700 !important;
            text-transform: uppercase !important;
            letter-spacing: 0.5px !important;
            border-bottom: 2px solid var(--accent-blue) !important;
            padding: 0.5rem 0 !important;
            margin: 0 0 1rem 0 !important;
        }
        
        .modal-acknowledge {
            padding: 1rem 2rem !important;
            font-size: 1rem !important;
            min-width: 240px !important;
            white-space: nowrap !important;
            text-align: center !important;
        }
        
        .modal-footer {
            padding: 1.5rem 2rem !important;
            min-height: 80px !important;
        }
        
        /* Scroll Progress Bar */
        .scroll-progress {
            position: sticky !important;
            top: 0 !important;
            height: 4px !important;
            background: #e5e7eb !important;
            z-index: 10 !important;
        }
        
        .scroll-progress-bar {
            height: 100% !important;
            background: linear-gradient(90deg, var(--primary-blue) 0%, var(--accent-blue) 100%) !important;
            width: 0% !important;
            transition: width 0.2s ease !important;
        }
        
        /* Button State Improvements */
        .modal-acknowledge:disabled {
            background: #9ca3af !important;
            border-color: #9ca3af !important;
            color: #6b7280 !important;
            cursor: not-allowed !important;
            opacity: 0.7 !important;
        }
        
        .modal-acknowledge.enabled {
            background: var(--primary-blue) !important;
            animation: enablePulse 0.5s ease !important;
        }
        
        @keyframes enablePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* Scroll Notice */
        .scroll-notice {
            font-size: 0.9rem !important;
            color: var(--text-secondary) !important;
            font-style: italic !important;
        }
        
        .scroll-notice.completed {
            color: var(--success-green) !important;
            font-weight: 500 !important;
        }
    </style>
    <link rel="stylesheet" href="assets/css/loading.css">
    <link rel="stylesheet" href="assets/css/print.css">
    <link rel="stylesheet" href="assets/css/main.css">
    
    <!-- Security -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
</head>
<body>
    <!-- Skip Navigation for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Header -->
    <header class="site-header" role="banner">
        <div class="container">
            <div class="header-content">
                <div class="logo-section">
                    <img src="assets/images/logos/AirSpace Integration Logo.png" alt="AirSpace Integration" class="logo">
                    <div class="site-title">
                        <h1>CA-66 Airport Usage License Agreement</h1>
                        <p class="subtitle">Monterey Bay Academy Airport</p>
                    </div>
                </div>
                
                <!-- Progress Indicator -->
                <div class="progress-indicator" role="progressbar" aria-label="Form completion progress" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                    <span class="progress-text">0% Complete</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="main-content" role="main">
        <div class="container">
            <!-- Introduction -->
            <section class="intro-section" aria-labelledby="intro-heading">
                <h2 id="intro-heading">Generate Your Airport Usage License Agreement</h2>
                <p class="intro-text">
                    Complete this form to generate your official CA-66 Airport Usage License Agreement. 
                    All fields marked with an asterisk (*) are required. The process takes approximately 5 minutes.
                </p>
                
                <!-- Important Notice -->
                <div class="notice-box" role="region" aria-labelledby="notice-heading">
                    <h3 id="notice-heading">Important Requirements</h3>
                    <ul>
                        <li>Minimum 300 flight hours required</li>
                        <li>$1,000,000 minimum insurance coverage</li>
                        <li>Single Engine Reciprocating aircraft only</li>
                        <li>Maximum takeoff weight under 12,500 lbs</li>
                        <li>No operations during Sabbath (Friday sunset - Saturday sunset)</li>
                    </ul>
                </div>
            </section>

            <!-- Agreement Form -->
            <form id="agreement-form" class="agreement-form" novalidate>
                <!-- Section 1: Licensee Information -->
                <fieldset class="form-section" id="licensee-section">
                    <legend>1. Licensee Information</legend>
                    <div class="section-content">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="licensee-name">Full Name *</label>
                                <input type="text" id="licensee-name" name="licensee-name" required>
                            </div>
                            <div class="form-group">
                                <label for="company-name">Company Name</label>
                                <input type="text" id="company-name" name="company-name">
                            </div>
                        </div>
                        
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="phone">Phone Number *</label>
                                <input type="tel" id="phone" name="phone" required>
                            </div>
                            <div class="form-group">
                                <label for="email">Email Address *</label>
                                <input type="email" id="email" name="email" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="flight-hours-confirmation" name="flight-hours-confirmation" required>
                                <label for="flight-hours-confirmation">I confirm that I have at least 300 hours of total flight time *</label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="medical-cert" name="medical-cert" required>
                                <label for="medical-cert">I hold a valid medical certificate *</label>
                            </div>
                        </div>
                    </div>
                </fieldset>

                <!-- Section 2: Aircraft Information -->
                <fieldset class="form-section" id="aircraft-section">
                    <legend>2. Aircraft Information</legend>
                    <div class="section-content">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="aircraft-registration">Aircraft Registration Number *</label>
                                <input type="text" id="aircraft-registration" name="aircraft-registration" placeholder="e.g., N12345" required>
                            </div>
                            <div class="form-group">
                                <label for="aircraft-make-model">Aircraft Make/Model *</label>
                                <input type="text" id="aircraft-make-model" name="aircraft-make-model" placeholder="e.g., Cessna 172" required>
                            </div>
                        </div>
                        
                        <div class="aircraft-notice">
                            <h4>Aircraft Type Restriction</h4>
                            <p><strong>Single Engine Reciprocating Aircraft Only</strong></p>
                            <p>This airport exclusively accommodates single-engine reciprocating aircraft. No turbine or multi-engine aircraft permitted.</p>
                        </div>
                        
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="mtow-confirmation" name="mtow-confirmation" required>
                                <label for="mtow-confirmation">I confirm this aircraft has a Maximum Takeoff Weight (MTOW) under 12,500 lbs *</label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="grass-field-capable" name="grass-field-capable" required>
                                <label for="grass-field-capable">I confirm this aircraft is capable of safe grass field operations *</label>
                            </div>
                        </div>
                        
                        <div class="upload-notice">
                            <h4>Required Documentation</h4>
                            <p><strong>Aircraft Registration Certificate:</strong> Please ensure you have your current aircraft registration certificate available for verification during your visit.</p>
                        </div>
                    </div>
                </fieldset>

                <!-- Section 3: Insurance Information -->
                <fieldset class="form-section" id="insurance-section">
                    <legend>3. Insurance Information</legend>
                    <div class="section-content">
                        <div class="form-group">
                            <label for="insured-name">Name of Insured *</label>
                            <input type="text" id="insured-name" name="insured-name" required>
                            <small>This should match the licensee name or company name</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="insurance-company">Insurance Company Name *</label>
                            <input type="text" id="insurance-company" name="insurance-company" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="insurance-address">Insurance Company Address *</label>
                            <input type="text" id="insurance-address" name="insurance-address" required>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="insurance-city">City *</label>
                                <input type="text" id="insurance-city" name="insurance-city" required>
                            </div>
                            <div class="form-group">
                                <label for="insurance-state">State *</label>
                                <select id="insurance-state" name="insurance-state" required>
                                    <option value="">Select State...</option>
                                </select>
                                <small>Select the state where your insurance company is located</small>
                            </div>
                            <div class="form-group">
                                <label for="insurance-zip">ZIP Code *</label>
                                <input type="text" id="insurance-zip" name="insurance-zip" pattern="[0-9]{5}(-[0-9]{4})?" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="insurance-phone">Insurance Company Phone *</label>
                                <input type="tel" id="insurance-phone" name="insurance-phone" required>
                            </div>
                            <div class="form-group">
                                <label for="policy-number">Policy Number *</label>
                                <input type="text" id="policy-number" name="policy-number" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="policy-expiry">Policy Expiration Date *</label>
                                <input type="date" id="policy-expiry" name="policy-expiry" required>
                            </div>
                            <div class="form-group">
                                <label for="coverage-amount">Coverage Amount *</label>
                                <input type="number" id="coverage-amount" name="coverage-amount" min="1000000" step="1000" required>
                                <small>Minimum $1,000,000 required</small>
                            </div>
                        </div>
                        
                        <div class="upload-notice">
                            <h4>Required Documentation</h4>
                            <p><strong>Insurance Certificate:</strong> Please ensure you have your current insurance certificate available that names all required additional insureds.</p>
                        </div>
                    </div>
                </fieldset>

                <!-- Section 4: Agreement Terms -->
                <fieldset class="form-section" id="terms-section">
                    <legend>4. Agreement Terms</legend>
                    <div class="section-content">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="start-date">Agreement Start Date</label>
                                <input type="date" id="start-date" name="start-date" readonly>
                                <small>Auto-populated with today's date</small>
                            </div>
                            <div class="form-group">
                                <label for="end-date">Agreement End Date</label>
                                <input type="date" id="end-date" name="end-date" readonly>
                                <small>One year from start date</small>
                            </div>
                        </div>
                        
                        <div class="fee-display">
                            <h4>Annual Fee</h4>
                            <div class="fee-amount">$250.00</div>
                            <p>This annual fee supports aviation education programs at Monterey Bay Academy.</p>
                        </div>
                        
                        <div class="acknowledgments">
                            <h4>Required Acknowledgments</h4>
                            
                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="sabbath-observance" name="sabbath-observance" required>
                                    <label for="sabbath-observance">I acknowledge and agree to observe the Sabbath restriction: No aircraft operations from Friday sunset to Saturday sunset *</label>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="airport-rules" name="airport-rules" required>
                                    <label for="airport-rules">I have read, understood, and agree to comply with all airport rules and regulations as outlined in Exhibit A *</label>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="liability-waiver" name="liability-waiver" required>
                                    <label for="liability-waiver">I understand and agree to the liability waiver and indemnification terms contained in this agreement *</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>

                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="button" id="clear-form" class="btn btn-secondary">Clear Form</button>
                    <button type="submit" id="generate-agreement" class="btn btn-primary" disabled>Generate Agreement</button>
                    <button type="button" id="generate-pdf" class="btn btn-primary" disabled>Generate PDF Agreement</button>
                </div>
            </form>

            <!-- Agreement Preview (Hidden by default) -->
            <section id="agreement-preview" class="agreement-preview" aria-live="polite" hidden>
                <h2>Agreement Preview</h2>
                <div id="agreement-content" class="agreement-content">
                    <!-- Generated agreement will be inserted here -->
                </div>
                <div class="preview-actions">
                    <button type="button" id="edit-agreement" class="btn btn-secondary">Edit Details</button>
                    <button type="button" id="email-agreement" class="btn btn-success">📧 Send via Email</button>
                    <button type="button" id="print-agreement" class="btn btn-primary">Print Agreement</button>
                    <button type="button" id="download-pdf" class="btn btn-primary">Download PDF Agreement</button>
                </div>
            </section>
        </div>
    </main>

    <!-- Email Modal -->
    <div id="email-modal" class="modal-overlay" role="dialog" aria-labelledby="email-modal-title" aria-hidden="true">
        <div class="modal-container">
            <div class="modal-header">
                <h2 id="email-modal-title">📧 Send Agreement via Email</h2>
                <button type="button" class="modal-close" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="email-form" class="email-form">
                    <div class="form-group">
                        <label for="email-recipient">Recipient Email Address *</label>
                        <input type="email" id="email-recipient" name="email-recipient" required>
                        <small class="form-help">Agreement will be sent to this email address</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="email-recipient-name">Recipient Name *</label>
                        <input type="text" id="email-recipient-name" name="email-recipient-name" required>
                        <small class="form-help">Name to use in email greeting</small>
                    </div>
                    
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="include-pdf-attachment" name="include-pdf-attachment" checked>
                            <label for="include-pdf-attachment">Include PDF attachment</label>
                        </div>
                        <small class="form-help">Attach fillable PDF version of the agreement</small>
                    </div>
                    
                    <div class="email-preview">
                        <h3>Email Preview</h3>
                        <div class="preview-summary">
                            <p><strong>Subject:</strong> <span id="email-subject-preview">CA-66 Airport Usage License Agreement</span></p>
                            <p><strong>From:</strong> AirSpace Integration, Inc.</p>
                            <p><strong>Contents:</strong> Professional email with agreement details and next steps</p>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="cancel-email" class="btn btn-secondary">Cancel</button>
                <button type="button" id="send-email" class="btn btn-success">📧 Send Agreement</button>
            </div>
        </div>
    </div>

    <!-- Footer -->1
    <footer class="site-footer" role="contentinfo">
        <div class="container">
            <div class="footer-content">
                <div class="legal-disclaimer">
                    <p>
                        <strong>Legal Notice:</strong> This agreement generator creates legally binding documents. 
                        By using this service, you acknowledge that you have read and understood all terms and conditions. 
                        For questions, contact AirSpace Integration, Inc.
                    </p>
                </div>
                <div class="footer-info">
                    <p>&copy; 2025 AirSpace Integration, Inc. All rights reserved.</p>
                    <p>CA-66 Monterey Bay Academy Airport</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- PDF Library -->
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    
    <!-- Exhibit A Modal -->
    <div id="exhibit-modal" class="modal-overlay" aria-hidden="true" role="dialog" aria-labelledby="modal-title" aria-describedby="modal-description">
        <div class="modal-container" tabindex="-1">
            <div class="modal-header">
                <div class="modal-logo-section">
                    <img src="assets/images/logos/AirSpace Integration Logo.png" alt="AirSpace Integration" class="modal-logo">
                    <div class="modal-title-section">
                        <h3 id="modal-title">Exhibit A - Airport Rules and Regulations</h3>
                        <p class="modal-subtitle">Monterey Bay Academy Airport</p>
                    </div>
                </div>
                <button class="modal-close" aria-label="Close modal" type="button">&times;</button>
            </div>
            <div class="modal-body">
                <div class="scroll-progress">
                    <div class="scroll-progress-bar"></div>
                </div>
                <div id="modal-description" class="exhibit-content">
                    <!-- Content will be injected here by JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <p class="scroll-notice">Please scroll to read all terms</p>
                <button class="modal-acknowledge" disabled type="button">I Have Read and Understand</button>
            </div>
        </div>
    </div>

    <!-- JavaScript Modules -->
    <script type="module" src="assets/js/config.js"></script>
    <script type="module" src="assets/js/validators.js"></script>
    <script type="module" src="assets/js/calculator.js"></script>
    <script type="module" src="assets/js/exhibit-content.js"></script>
    <script type="module" src="assets/js/ui-enhancements.js"></script>
    <script type="module" src="assets/js/sticky-header.js"></script>
    <script type="module" src="assets/js/template.js"></script>
    <script type="module" src="assets/js/pdf-position-config.js"></script>
    <script type="module" src="assets/js/generator.js"></script>
    <script type="module" src="assets/js/ui.js"></script>
    <script type="module" src="assets/js/app.js"></script>
</body>
</html>