# Story 1.1: Enhanced PDF Generation

## Status
Draft

## Story
**As a** pilot completing the CA-66 agreement form,
**I want** to generate a PDF document with proper field formatting,
**so that** I can submit a professional document for insurance and airport approval.

## Acceptance Criteria
1. PDF generation uses fillable form fields instead of text overlays
2. All form data populates correctly in designated PDF fields
3. Generated document maintains professional formatting standards
4. PDF is immediately ready for printing or digital submission

## Tasks / Subtasks
- [ ] Task 1: Replace text overlay system with fillable PDF field population (AC: 1)
  - [ ] Remove existing text overlay positioning logic from PDFLibGenerator
  - [ ] Implement proper PDF form field detection and population
  - [ ] Update field mapping to use actual PDF form field names
- [ ] Task 2: Enhance field mapping accuracy (AC: 2)
  - [ ] Audit all 24 PDF form fields against current form data structure
  - [ ] Update createFieldMapping() method in PDFGenerator class
  - [ ] Implement proper date formatting (DD/MM/YYYY) for legal documents
  - [ ] Handle special characters and edge cases in field population
- [ ] Task 3: Implement professional formatting standards (AC: 3)
  - [ ] Ensure text fits within PDF field boundaries
  - [ ] Maintain consistent font sizing across all fields
  - [ ] Preserve legal document structure across 5-page template
- [ ] Task 4: Optimize for immediate use (AC: 4)
  - [ ] Test print output matches digital preview
  - [ ] Validate PDF opens correctly in standard PDF viewers
  - [ ] Ensure cross-browser PDF generation consistency

## Dev Notes

### Previous Story Insights
This is the first story in the project.

### Current Architecture Context
**Source Tree Information [Source: Project Analysis]:**
- Main application entry: `assets/js/app.js` (modular ES6 structure)
- PDF generation: `assets/js/pdf-generator.js` â†’ `assets/js/pdf-lib-generator.js`
- Form validation: `assets/js/validators.js`
- UI management: `assets/js/ui.js`
- Configuration: `assets/js/config.js`

**Technology Stack [Source: package.json analysis]:**
- Vanilla JavaScript (ES6+ modules) - zero dependencies for security
- pdf-lib library v1.17.1 for PDF manipulation
- Static hosting (Python HTTP server for dev)
- Client-side only processing (no backend)

**Data Models [Source: pdf-generator.js analysis]:**
- Form data structure includes: licensee info, aircraft details, insurance info, agreement terms
- Date formatting: DD/MM/YYYY for legal documents
- Aircraft info: registration + make/model combination
- Insurance coverage: minimum $1,000,000 formatted as currency

**Current PDF Generation Flow [Source: PDFGenerator class analysis]:**
1. `PDFGenerator.generateAgreementPDF(formData)` - main entry point
2. `PDFGenerator.createFieldMapping(formData)` - maps form to PDF fields
3. `PDFLibGenerator.generateFilledPDF(formData)` - handles pdf-lib operations
4. Current issue: Uses text overlay positioning instead of fillable form fields

**File Locations [Source: Project structure]:**
- PDF generation logic: `assets/js/pdf-generator.js`
- Core PDF library interface: `assets/js/pdf-lib-generator.js`
- PDF template location: `assets/examples/[TEMPLATE] New CA66 Monterey Bay Academy Airport License Agreement_July29.pdf`
- Field position config: `assets/js/pdf-position-config.js`

**Technical Constraints [Source: PRD and CLAUDE.md]:**
- Client-side processing only (no server-side storage)
- 5-page PDF template with 24 form fields
- Must maintain sub-3 second generation time
- Support Chrome, Firefox, Safari, Edge browsers
- Print-ready 8.5x11 inch format required

### Testing
**Testing Standards:**
No specific testing framework found in architecture docs. Current project has:
- Manual testing files: `test-*.html` files in project root
- Debug tools: `debug-pdf-positions.html`, `position-fine-tuning.html`
- Test command: `npm run test-pdf` (runs `test-pdf-filler.js`)

**Testing Requirements for This Story:**
- Test PDF generation across all supported browsers
- Validate field population accuracy for all 24 fields
- Verify print output matches digital preview
- Test edge cases (empty fields, special characters)

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-08 | 1.0 | Initial story creation for enhanced PDF generation | Bob (Scrum Master) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review will be populated here*